apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "cur-ingestion-app.fullname" . }}-config
  labels:
    {{- include "cur-ingestion-app.labels" . | nindent 4 }}
data:
  config.yaml: |
    # CUR Ingestion Application Configuration
    # Generated by Helm

    # GCP Configuration
    gcp:
      project.id: {{ .Values.config.gcp.projectId | quote }}
      service.account.key: {{ .Values.config.gcp.serviceAccountKey | quote }}

    # GCS Configuration
    gcs:
      bucket: {{ .Values.config.gcs.bucket | quote }}

    # CUR File Configuration
    cur:
      file.path: {{ .Values.config.cur.filePath | quote }}

    # BigQuery Configuration
    bigquery:
      table: {{ .Values.config.bigquery.table | quote }}
      temp.bucket: {{ .Values.config.bigquery.tempBucket | quote }}

    # Tagging Configuration
    tagging:
      rules.file: {{ .Values.config.tagging.rulesFile | quote }}
      use.scd: {{ .Values.config.tagging.useScd }}
      mode: {{ .Values.config.tagging.mode | quote }}

  tagging-rules.properties: |
    # CUR Tagging Rules
    # Generated by Helm
    {{- range $i, $rule := .Values.taggingRules }}
    rule.{{ add $i 1 }}.name={{ $rule.name }}
    rule.{{ add $i 1 }}.field={{ $rule.field }}
    rule.{{ add $i 1 }}.operator={{ $rule.operator }}
    rule.{{ add $i 1 }}.value={{ $rule.value }}
    rule.{{ add $i 1 }}.tag={{ $rule.tag }}
    {{- end }}
